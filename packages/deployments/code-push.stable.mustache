#!/bin/bash
# Simplify Automatic Deployment Script
# Project: {{projectNamePosix}}
# Deployment: {{deploymentNamePosix}}
# Region: {{deploymentRegionOrigin}}
# Profile: {{deploymentProfileOrigin}}
# Version: {{projectVersion}}
INITIAL_DIR=$PWD

node code-init.js --input {{deploymentNamePosix}}.json

{{#services}}
export DEPLOYMENT_STAGE=stable
export ENFORCEMENT_PACKAGE=
cd ${INITIAL_DIR}/{{projectName}}/{{serviceName}} && npm install && npm run build-layer && npm run deploy-layer && cd -
if [ $? -ne 0 ]; then
    echo "Publishing {{serviceName}} (stable) version has failed!"
    exit 255
fi
{{/services}}